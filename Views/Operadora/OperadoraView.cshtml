@model List<AppValetParking.Models.ValetRegistro>

    @{
    ViewData["Title"] = "Operadora";
    }

    <div class="operadora-input d-flex align-items-center">
        <label for="codigoOperador" class="me-2">Operadora:</label>
        <input type="text" id="codigoOperador" placeholder="Coloque su gaffete" />
        <span id="nombreEmpleado" style="margin-left: 10px; font-weight: bold;"></span>

        <div class="ms-auto">
            <form asp-controller="Account" asp-action="Logout" method="post" class="mb-0" onsubmit="limpiarCamposOperadora()">
                <button type="submit" class="btn btn-outline-danger">Cerrar sesión</button>
            </form>
        </div>
    </div>



    <!-- CSS externo -->
    <link href="~/css/operadora.css" rel="stylesheet" />

    <div class="d-flex justify-content-between align-items-end mb-3 flex-wrap">

        <!-- Formulario de filtro fechas (GET para filtrar en la vista) -->
        <form method="get" asp-controller="Operadora" asp-action="Index" class="d-flex gap-2 align-items-end flex-wrap">
            <div>
                <label for="fechaInicioFiltro">Fecha inicio:</label>
                <input type="date" id="fechaInicioFiltro" name="fechaInicio" class="form-control" value="@ViewBag.FechaInicio" />
            </div>
            <div>
                <label for="fechaFinFiltro">Fecha fin:</label>
                <input type="date" id="fechaFinFiltro" name="fechaFin" class="form-control" value="@ViewBag.FechaFin" />
            </div>
            <div>
                <button type="submit" class="btn btn-primary">
                    Filtrar
                </button>
            </div>
            <div>
                <a asp-controller="Operadora" asp-action="Index" class="btn btn-secondary">
                    Limpiar
                </a>
            </div>
        </form>

        <!-- Formulario Exportar a Excel -->
        <form asp-controller="Operadora" asp-action="ExportarExcel" method="post" class="d-flex gap-2 align-items-end flex-wrap" target="_blank">
            <div>
                <label for="fechaInicioExportar">Fecha inicio:</label>
                <input type="date" id="fechaInicioExportar" name="fechaInicio" class="form-control" required value="@DateTime.Now.ToString("yyyy-MM-dd")" />
            </div>
            <div>
                <label for="fechaFinExportar">Fecha fin:</label>
                <input type="date" id="fechaFinExportar" name="fechaFin" class="form-control" required value="@DateTime.Now.ToString("yyyy-MM-dd")" />
            </div>
            <div>
                <button type="submit" class="btn btn-success">
                    Exportar a Excel
                </button>
            </div>
        </form>

    </div>





    <div class="container-fluid mt-4 px-0">
        @ViewData["Title"]

        <div class="mb-3">
            <input type="text" id="filtroTabla" class="form-control" placeholder="Escribe para filtrar..." />
        </div>

        <div class="table-responsive shadow-sm rounded">
            <table class="table table-striped align-middle" id="tablaOperadora">
                <thead>
                    <tr>
                        <th>Fecha Registro</th>
                        <th>N. Operadora</th>
                        <th>Solicitud</th>
                        <th>Hab</th>
                        <th>Hotel</th>
                        <th>Folio VP</th>
                        <th>Valet</th>
                        <th>Servicio</th>
                        <th>Hora Salida</th>
                        <th>Cajón</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
  {
                    <tr data-id="@item.Id">
                        <td>@item.Fecha.ToShortDateString()</td>
                        <td>@item.Operacion</td>
                        <td>@(item.Solicitud?.ToString(@"hh\:mm\:ss") ?? "")</td>
                        <td>@item.Habitacion</td>
                        <td>@item.Hotel</td>
                        <td>@item.FolioVP</td>
                        <td>
                            <input type="text" name="Valet" value="@item.Valet" class="form-control input-operadora" placeholder="Valet" form="form-@item.Id" />
                        </td>
                        <td>
                            <select name="Servicio" class="form-control input-operadora" form="form-@item.Id">
                                @foreach (var opcion in (List<ServicioItem>)ViewBag.Servicios)
    {
                                <option value="@opcion.Value" selected="@(item.Servicio == opcion.Value ? "selected" : null)">
                                    @opcion.Text
                                </option>
    }
                            </select>


                        </td>
                        <td>
                            <input type="time" name="HoraSalida" value="@(item.HoraSalida?.ToString(@"hh\:mm") ?? "")" class="form-control input-operadora" form="form-@item.Id" />
                        </td>
                        <td>
                            <input type="text" name="CajonBuffer" value="@item.CajonBuffer" class="form-control input-operadora" placeholder="Cajón" form="form-@item.Id" />
                        </td>
                        <td>
                            <form asp-action="ActualizarRegistro" method="post" id="form-@item.Id">
                                <input type="hidden" name="Id" value="@item.Id" />
                                <input type="hidden" name="Operacion" class="input-operadora-nombre" />

                                <button type="button" class="btn btn-info btn-sm btn-ver-movimientos" data-id="@item.Id" style="min-width: 50px;">
                                    Ver M.
                                </button>
                                <button type="submit" class="btn btn-primary btn-sm" title="Guardar cambios" style="min-width: 80px;">
                                    Guardar
                                </button>

                                <button type="button"
                                        class="btn btn-secondary btn-sm btn-mas-opciones"
                                        data-id="@item.Id"
                                        data-hostname="@item.HOSTNAME"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalOpciones"
                                        title="Más opciones"
                                        style="min-width: 40px;">
                                    ...
                                </button>
                            </form>



                        </td>
                    </tr>
  }
                </tbody>

            </table>
        </div>
    </div>
    <!-- Modal para editar información adicional -->
    <div class="modal fade" id="modalOpciones" tabindex="-1" aria-labelledby="modalOpcionesLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" asp-controller="Operadora" asp-action="ActualizarHostname">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalOpcionesLabel">Editar información adicional</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="Id" id="modalRegistroId" />
                        <div class="mb-3">
                            <label for="modalHostname" class="form-label">Detalles:</label>
                            <input type="text" class="form-control" id="modalHostname" name="HOSTNAME" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar cambios</button>
                    </div>
                </div>
            </form>
        </div>
    </div>




    <!-- JS externo -->
    <script src="~/js/operadora.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const botones = document.querySelectorAll(".btn-mas-opciones");
            botones.forEach(btn => {
                btn.addEventListener("click", function () {
                    const id = btn.getAttribute("data-id");
                    const hostname = btn.getAttribute("data-hostname");

                    document.getElementById("modalRegistroId").value = id;
                    document.getElementById("modalHostname").value = hostname;
                });
            });
        });
    </script>
